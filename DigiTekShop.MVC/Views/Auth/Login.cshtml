@using DigiTekShop.Contracts.DTOs.Auth.Login
@model LoginRequest
@{
    ViewData["Title"] = "Login";
    var returnUrl = (string?)ViewData["ReturnUrl"] ?? string.Empty;
}

<h1 class="mb-4">Sign in</h1>

<form asp-action="Login" method="post" novalidate class="max-w-md" id="login-form">
    @Html.AntiForgeryToken()
    <input type="hidden" name="returnUrl" value="@returnUrl" />

    <div class="validation-summary text-danger mb-3">
        @Html.ValidationSummary(excludePropertyErrors: true, message: null)
    </div>

    <div class="mb-3">
        <label asp-for="Login" class="form-label">Email or Username</label>
        <input asp-for="Login" class="form-control" autocomplete="username" />
        <span asp-validation-for="Login" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Password" class="form-label">Password</label>
        <div class="input-group">
            <input asp-for="Password" class="form-control" autocomplete="current-password" type="password" id="password-input" />
            <button type="button" class="btn btn-outline-secondary" id="toggle-password" aria-label="Show password">Show</button>
        </div>
        <span asp-validation-for="Password" class="text-danger"></span>
    </div>

    <div class="form-check mb-3">
        <input asp-for="RememberMe" class="form-check-input" />
        <label asp-for="RememberMe" class="form-check-label">Remember this device</label>
    </div>

    @* اگر کپچا داری، مقدار توکن رو اینجا بگذار *@
    @* <input asp-for="CaptchaToken" type="hidden" id="captcha-token" /> *@

    <div class="d-grid gap-2">
        <button type="submit" class="btn btn-primary" id="submit-btn">
            Sign in
        </button>
    </div>

    <div class="mt-3">
        @* لینک‌های انتخابی *@
        @* <a asp-controller="Auth" asp-action="ForgotPassword">Forgot your password?</a> *@
    </div>
</form>

@section Scripts {
    <!-- unobtrusive validation -->
    <partial name="_ValidationScriptsPartial" />

    <script>
        (function () {
            const form = document.getElementById('login-form');
            const submitBtn = document.getElementById('submit-btn');
            const pwd = document.getElementById('password-input');
            const toggle = document.getElementById('toggle-password');

            // Disable submit on submit to prevent double-post
            form.addEventListener('submit', function () {
                submitBtn.disabled = true;
                submitBtn.innerText = 'Signing in...';
            });

            // Show/Hide password
            toggle.addEventListener('click', function () {
                const showing = pwd.getAttribute('type') === 'text';
                pwd.setAttribute('type', showing ? 'password' : 'text');
                toggle.textContent = showing ? 'Show' : 'Hide';
                toggle.setAttribute('aria-label', showing ? 'Show password' : 'Hide password');
            });

            // اگر کپچا داری، قبل از submit مقدار CaptchaToken را پر کن
            // example:
            // grecaptcha.ready(function() {
            //   grecaptcha.execute('site-key', {action: 'login'}).then(function(token) {
            //     document.getElementById('captcha-token').value = token;
            //   });
            // });
        })();
    </script>
}

<style>
    /* استایل‌های ساده؛ اگر Bootstrap داری می‌تونی حذف کنی */
    .max-w-md {
        max-width: 420px;
    }

    .form-label {
        font-weight: 600;
    }

    .validation-summary ul {
        margin: 0;
        padding-left: 1rem;
    }
</style>
