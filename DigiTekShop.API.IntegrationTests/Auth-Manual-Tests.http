### ==============================================
### DigiTekShop Auth - Manual API Tests
### Ø§Ø³ØªÙØ§Ø¯Ù‡: Ø§Ø² VS Code REST Client ÛŒØ§ JetBrains HTTP Client
### ==============================================

@baseUrl = http://localhost:5000
@apiVersion = v1

### Ù…ØªØºÛŒØ±Ù‡Ø§ (Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ø¬Ø±Ø§ set Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯)
# @phone = +989121234567
# @code = 123456
# @accessToken = eyJhbGciOiJIUzI1...
# @refreshToken = abc123...
# @userId = 3fa85f64-5717-4562-b3fc-2c963f66afa6

### ==============================================
### 1ï¸âƒ£ SEND OTP - Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯ ØªØ§ÛŒÛŒØ¯
### ==============================================
POST {{baseUrl}}/api/{{apiVersion}}/auth/send-otp
Content-Type: application/json

{
  "phone": "+989121234567"
}

### ØªØ³Øª: Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ (Ø¨Ø§ÛŒØ¯ 429 Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯)
POST {{baseUrl}}/api/{{apiVersion}}/auth/send-otp
Content-Type: application/json

{
  "phone": "+989121234567"
}

### ØªØ³Øª: Ø´Ù…Ø§Ø±Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø± (Ø¨Ø§ÛŒØ¯ 400 ÛŒØ§ 422 Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯)
POST {{baseUrl}}/api/{{apiVersion}}/auth/send-otp
Content-Type: application/json

{
  "phone": "invalid-phone"
}

### ==============================================
### 2ï¸âƒ£ VERIFY OTP - ØªØ§ÛŒÛŒØ¯ Ú©Ø¯ (Ø§Ø´ØªØ¨Ø§Ù‡)
### ==============================================
POST {{baseUrl}}/api/{{apiVersion}}/auth/verify-otp
Content-Type: application/json

{
  "phone": "+989121234567",
  "code": "000000"
}

### ==============================================
### 3ï¸âƒ£ VERIFY OTP - ØªØ§ÛŒÛŒØ¯ Ú©Ø¯ (ØµØ­ÛŒØ­)
### ØªÙˆØ¬Ù‡: Ú©Ø¯ ÙˆØ§Ù‚Ø¹ÛŒ Ø±Ø§ Ø§Ø² SMS/Ù„Ø§Ú¯ Ø¨Ø±Ø¯Ø§Ø±ÛŒØ¯
### ==============================================
# @name login
POST {{baseUrl}}/api/{{apiVersion}}/auth/verify-otp
Content-Type: application/json

{
  "phone": "+989121234567",
  "code": "123456"
}

### Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙˆÚ©Ù†â€ŒÙ‡Ø§
@accessToken = {{login.response.body.$.data.accessToken}}
@refreshToken = {{login.response.body.$.data.refreshToken}}
@userId = {{login.response.body.$.data.userId}}

### ==============================================
### 4ï¸âƒ£ ME - Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¬Ø§Ø±ÛŒ
### ==============================================
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Authorization: Bearer {{accessToken}}

### ØªØ³Øª: Ø¨Ø¯ÙˆÙ† Authorization (Ø¨Ø§ÛŒØ¯ 401 Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯)
GET {{baseUrl}}/api/{{apiVersion}}/auth/me

### ==============================================
### 5ï¸âƒ£ REFRESH TOKEN - ØªØ§Ø²Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªÙˆÚ©Ù†
### ==============================================
# @name refresh
POST {{baseUrl}}/api/{{apiVersion}}/auth/refresh-token
Content-Type: application/json

{
  "refreshToken": "{{refreshToken}}"
}

### Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
@newAccessToken = {{refresh.response.body.$.data.accessToken}}
@newRefreshToken = {{refresh.response.body.$.data.refreshToken}}

### ØªØ³Øª: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø² Ù‡Ù…Ø§Ù† refresh token (Ø¨Ø§ÛŒØ¯ 401 Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯)
POST {{baseUrl}}/api/{{apiVersion}}/auth/refresh-token
Content-Type: application/json

{
  "refreshToken": "{{refreshToken}}"
}

### ==============================================
### 6ï¸âƒ£ LOGOUT - Ø®Ø±ÙˆØ¬ Ø§Ø² Ø¯Ø³ØªÚ¯Ø§Ù‡ ÙØ¹Ù„ÛŒ
### ==============================================
POST {{baseUrl}}/api/{{apiVersion}}/auth/logout
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "userId": "{{userId}}"
}

### ØªØ³Øª: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡Ù…Ø§Ù† access token Ø¨Ø¹Ø¯ Ø§Ø² logout (Ø¨Ø§ÛŒØ¯ 401 Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯)
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Authorization: Bearer {{accessToken}}

### ==============================================
### 7ï¸âƒ£ LOGOUT ALL - Ø®Ø±ÙˆØ¬ Ø§Ø² ØªÙ…Ø§Ù… Ø¯Ø³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§
### ==============================================
POST {{baseUrl}}/api/{{apiVersion}}/auth/logout-all
Authorization: Bearer {{newAccessToken}}
Content-Type: application/json

{
  "userId": "{{userId}}"
}

### ==============================================
### 8ï¸âƒ£ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ú©Ø§Ù…Ù„: Login â†’ Refresh â†’ Logout
### ==============================================

### Step 1: Ø§Ø±Ø³Ø§Ù„ OTP
POST {{baseUrl}}/api/{{apiVersion}}/auth/send-otp
Content-Type: application/json

{
  "phone": "+989129876543"
}

###

### Step 2: ÙˆØ±ÛŒÙØ§ÛŒ OTP (Ú©Ø¯ ÙˆØ§Ù‚Ø¹ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯)
# @name fullFlow
POST {{baseUrl}}/api/{{apiVersion}}/auth/verify-otp
Content-Type: application/json

{
  "phone": "+989129876543",
  "code": "XXXXXX"
}

@flowAccessToken = {{fullFlow.response.body.$.data.accessToken}}
@flowRefreshToken = {{fullFlow.response.body.$.data.refreshToken}}
@flowUserId = {{fullFlow.response.body.$.data.userId}}

###

### Step 3: Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Authorization: Bearer {{flowAccessToken}}

###

### Step 4: Refresh
# @name flowRefresh
POST {{baseUrl}}/api/{{apiVersion}}/auth/refresh-token
Content-Type: application/json

{
  "refreshToken": "{{flowRefreshToken}}"
}

@flowNewAccessToken = {{flowRefresh.response.body.$.data.accessToken}}

###

### Step 5: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªÙˆÚ©Ù† Ø¬Ø¯ÛŒØ¯
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Authorization: Bearer {{flowNewAccessToken}}

###

### Step 6: Logout
POST {{baseUrl}}/api/{{apiVersion}}/auth/logout
Authorization: Bearer {{flowNewAccessToken}}
Content-Type: application/json

{
  "userId": "{{flowUserId}}"
}

###

### Step 7: ØªØ§ÛŒÛŒØ¯ logout (Ø¨Ø§ÛŒØ¯ 401 Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯)
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Authorization: Bearer {{flowNewAccessToken}}

### ==============================================
### ğŸ§ª ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Edge Case
### ==============================================

### ØªØ³Øª: OTP Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡ Ø®Ø§Ù„ÛŒ
POST {{baseUrl}}/api/{{apiVersion}}/auth/send-otp
Content-Type: application/json

{
  "phone": ""
}

###

### ØªØ³Øª: Verify Ø¨Ø§ Ú©Ø¯ Ø®Ø§Ù„ÛŒ
POST {{baseUrl}}/api/{{apiVersion}}/auth/verify-otp
Content-Type: application/json

{
  "phone": "+989121234567",
  "code": ""
}

###

### ØªØ³Øª: Verify Ø¨Ø§ Ú©Ø¯ ØºÛŒØ± Ø¹Ø¯Ø¯ÛŒ
POST {{baseUrl}}/api/{{apiVersion}}/auth/verify-otp
Content-Type: application/json

{
  "phone": "+989121234567",
  "code": "abc123"
}

###

### ØªØ³Øª: Refresh Ø¨Ø§ ØªÙˆÚ©Ù† Ø®Ø§Ù„ÛŒ
POST {{baseUrl}}/api/{{apiVersion}}/auth/refresh-token
Content-Type: application/json

{
  "refreshToken": ""
}

###

### ØªØ³Øª: Refresh Ø¨Ø§ ØªÙˆÚ©Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø±
POST {{baseUrl}}/api/{{apiVersion}}/auth/refresh-token
Content-Type: application/json

{
  "refreshToken": "invalid-token-12345"
}

### ==============================================
### ğŸ“Š Ù†Ú©Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡
### ==============================================
# 
# Û±. Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ (@accessToken, @refreshToken, ...) Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø±
#    Ø§Ø² response Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ (Ø¯Ø± VS Code REST Client)
# 
# Û². Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ØŒ Ø±ÙˆÛŒ "Send Request" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
# 
# Û³. Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø¯Ø± Ù¾Ù†Ø¬Ø±Ù‡ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
# 
# Û´. Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù† headers Ú©Ø§Ù…Ù„ØŒ Ø±ÙˆÛŒ "Response Headers" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
# 
# Ûµ. Ø¨Ø±Ø§ÛŒ ØªØ³Øª Rate LimitingØŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø³Ø±ÛŒØ¹ Ù¾Ø´Øª Ø³Ø± Ù‡Ù… Ø¨ÙØ±Ø³ØªÛŒØ¯
# 
# Û¶. Ú©Ø¯ OTP Ø±Ø§ Ø§Ø²:
#    - Console/Log Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†
#    - Ø¯ÛŒØªØ§Ø¨ÛŒØ³ (PhoneVerifications table)
#    - SMS ÙˆØ§Ù‚Ø¹ÛŒ (Ø¯Ø± production)
#    Ø¨Ø±Ø¯Ø§Ø±ÛŒØ¯
#
### ==============================================

